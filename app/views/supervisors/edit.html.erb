<h1><%= t(".title") %></h1>

<div class="card card-container">
  <div class="card-body">
    <%= form_for @supervisor, as: :supervisor, url: supervisor_path(@supervisor) do |form| %>
      <%= render "/shared/error_messages", resource: @supervisor %>

      <div class="field form-group">
        <%= form.label :email, t("common.email") %>
        <% if policy(@supervisor).update_supervisor_email? %>
          <%= form.text_field :email, class: "form-control" %>
        <% else %>
          <input class="form-control" type="text" placeholder="<%= @supervisor.email %>" autocomplete="off" readonly>
        <% end %>
      </div>

      <div class="field form-group">
        <%= form.label :display_name, t("common.display_name") %>
        <% if policy(@supervisor).update_supervisor_name? %>
          <%= form.text_field :display_name, class: "form-control" %>
        <% else %>
          <input class="form-control" type="text" placeholder="<%= @supervisor.display_name %>" autocomplete="off" readonly>
        <% end %>
      </div>

      <p>
        <%= render "/shared/invite_login", resource: @supervisor %>
      </p>

      <p>
        <%= render "manage_active", user: @supervisor %>
      </p>

      <div class="actions">
        <% if policy(@supervisor).update_supervisor_email? || policy(@supervisor).update_supervisor_name? %>
          <%= form.submit t("button.submit"), class: "btn btn-primary" %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<%=
  render(
    "shared/volunteer_assignment",
    staffable_obj: @supervisor,
    relational_obj: SupervisorVolunteer,
    relational_action: supervisor_volunteers_path(supervisor_id: @supervisor.id)
  ) do
%>
  <% button_text = @all_volunteers_ever_assigned.nil? ? t(".include_unassigned") : t(".hide_unassigned") %>

  <thead>
    <tr>
      <th><%= t(".heading.volunteer_name") %></th>
      <th><%= t(".heading.volunteer_email") %></th>
      <% if button_text == t(".hide_unassigned") %>
        <th><%= t(".heading.currently_assigned_to") %></th>
      <% end %>
      <th><%= t(".button.unassign") %></th>
    </tr>
  </thead>

  <tbody>
    <% (@all_volunteers_ever_assigned || @supervisor.volunteers).each do |volunteer| %>
      <tr>
        <td><%= link_to volunteer.display_name, edit_volunteer_path(volunteer) %></td>
        <td><%= volunteer.email %></td>
        <% if button_text == t(".hide_unassigned") %>
          <td>
            <%= volunteer.has_supervisor? ? volunteer.supervisor.display_name : "No One" %>
          </td>
        <% end %>
        <td>
          <% if volunteer.supervised_by?(@supervisor) %>
            <%=
              button_to(
                t(".button.unassign"),
                unassign_supervisor_volunteer_path(volunteer),
                method: :patch,
                class: "btn btn-danger"
              )
            %>
          <% else %>
            <%= t(".button.unassigned") %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
<% end %>
